/** * * FuturesUtils * * @author ace * * @version 2015/11/25 初始版本。 * * @see <a href="https://developer.mozilla.org/zh-TW/docs/JavaScript">JavaScript</a> * */var insertMonthFutures = function(spread, productCode, year, month) {	function getBeginTrnDate() {			var sheet = spread.getSheets().getByName('futures_day_trn_logs');				return sheet.getObject().getCellByPosition(0, 1).getFormula();	}		function getEndTrnDate() {			var sheet = spread.getSheets().getByName('futures_day_trn_logs');			var cellRange = Packages.com.sun.star.uno.UnoRuntime.queryInterface(Packages.com.sun.star.sheet.XSheetCellRange, sheet.getObject().getCellRangeByName('A1'));		var cursor = sheet.getObject().createCursorByRange(cellRange);		var usedCursor = Packages.com.sun.star.uno.UnoRuntime.queryInterface(Packages.com.sun.star.sheet.XUsedAreaCursor, cursor);				var addr;			usedCursor.gotoStartOfUsedArea(false);		usedCursor.gotoEndOfUsedArea(true);			addr = Packages.com.sun.star.uno.UnoRuntime.queryInterface(Packages.com.sun.star.sheet.XCellRangeAddressable, usedCursor);			// Packages.javax.swing.JOptionPane.showMessageDialog(null, addr.getRangeAddress().EndRow);				return sheet.getObject().getCellByPosition(0, addr.getRangeAddress().EndRow).getFormula();	}	  var sheet;	  sheet = spread.getSheets().getByName('futures_day_trn_logs');  if (sheet !== null) insertFuturesDayTrnLogs(sheet, productCode, year, month);  sheet = spread.getSheets().getByName('twse_day_trn_logs');  if (sheet !== null) insertTWSEDayTrnLogs(sheet, getBeginTrnDate(), getEndTrnDate());  sheet = spread.getSheets().getByName('futures_large_stay_logs');  if (sheet !== null) insertFuturesLargeStayLogs(sheet, productCode, year, month);  sheet = spread.getSheets().getByName('futures_large_stay_all_logs');  if (sheet !== null) insertFuturesLargeStayAllLogs(sheet, productCode, getBeginTrnDate(), getEndTrnDate());	  sheet = spread.getSheets().getByName('foreign_futures_day_trn_logs');  if (sheet !== null) insertForeignFuturesDayTrnLogs(sheet, productCode, getBeginTrnDate(), getEndTrnDate());	  sheet = spread.getSheets().getByName('dealer_futures_day_trn_logs');  if (sheet !== null) insertDealerFuturesDayTrnLogs(sheet, productCode, getBeginTrnDate(), getEndTrnDate());	  sheet = spread.getSheets().getByName('invest_futures_day_trn_logs');  if (sheet !== null) insertInvestFuturesDayTrnLogs(sheet, productCode, getBeginTrnDate(), getEndTrnDate());};var insertFuturesDayTrnLogs = function(sheet, productCode, year, month) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.FuturesDayTrnLogs"] + '.js');  var dao = new tw.ace33022.dao.db.vo.FuturesDayTrnLogs(Configurations.Database.getConnection());		var arrVO = dao.doSelectByConMonthOrderByTrnDate(productCode, year + month);  var index;  var vo;	  var posX = new Number(0);  var posY = new Number(1);  for (index = 0; index < arrVO.length; index++) {		vo = arrVO[index];				    posX = 0;    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getConMonth());    // sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getProductCode());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getOpenPoint());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getHighPoint());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getLowPoint());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getClosePoint());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getLastCalPoint());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayQty());    posY++;  }};var insertTWSEDayTrnLogs = function(sheet, beginDate, endDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["underscore"] + '.js');		load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.TWSEDayTrnLogs"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.FoundationAmountDayTrnLogs"] + '.js');	var dao;    var arrVO;	var arrFoundationVO;	  var index;  var vo;	var foundationVO;	  var posY = new Number(1);		dao = new tw.ace33022.dao.db.vo.TWSEDayTrnLogs(Configurations.Database.getConnection());	arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(beginDate, endDate);		dao = new tw.ace33022.dao.db.vo.FoundationAmountDayTrnLogs(Configurations.Database.getConnection());	arrFoundationVO = dao.doSelectBetweenTrnDateOrderByTrnDate(beginDate, endDate);	  for (index = 0; index < arrVO.length; index++) {		vo = arrVO[index];				    sheet.getObject().getCellByPosition(0, posY).setValue(vo.getTrnDate());    sheet.getObject().getCellByPosition(1, posY).setValue(vo.getOpenPoint());    sheet.getObject().getCellByPosition(2, posY).setValue(vo.getHighPoint());    sheet.getObject().getCellByPosition(3, posY).setValue(vo.getLowPoint());		sheet.getObject().getCellByPosition(4, posY).setValue(vo.getClosePoint());				foundationVO = _.find(arrFoundationVO, function(fvo) {return fvo.getTrnDate().toString() == vo.getTrnDate().toString();});		if (typeof foundationVO != 'undefined') {					sheet.getObject().getCellByPosition(5, posY).setValue(foundationVO.getDealerBuy());			sheet.getObject().getCellByPosition(6, posY).setValue(foundationVO.getDealerSell());			sheet.getObject().getCellByPosition(7, posY).setValue(foundationVO.getDealerHedgeBuy());			sheet.getObject().getCellByPosition(8, posY).setValue(foundationVO.getDealerHedgeSell());			sheet.getObject().getCellByPosition(9, posY).setValue(foundationVO.getInvestBuy());			sheet.getObject().getCellByPosition(10, posY).setValue(foundationVO.getInvestSell());			sheet.getObject().getCellByPosition(11, posY).setValue(foundationVO.getForeignBuy());			sheet.getObject().getCellByPosition(12, posY).setValue(foundationVO.getForeignSell());		}				sheet.getObject().getCellByPosition(13, posY).setValue(vo.getTrnTotal());    posY++;  }		return this;};var insertFuturesLargeStayLogs = function(sheet, productCode, year, month) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.FuturesLargeStayLogs"] + '.js');		var dao = new tw.ace33022.dao.db.vo.FuturesLargeStayLogs(Configurations.Database.getConnection());		var conMonth = new String(year + month);		var arrVO = dao.doSelectByConMonthOrderByTrnDate(productCode, conMonth);	  var index;  var vo;  var posX = new Number(0);  var posY = new Number(1);	for (index = 0; index < arrVO.length; index++) {					vo = arrVO[index];    posX = 0;				    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getConMonth());    // sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getProductCode());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayQty());						// 計算差異量		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'C' + (posY + 1) + '-' + 'G' + (posY + 1));		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'D' + (posY + 1) + '-' + 'H' + (posY + 1));		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'E' + (posY + 1) + '-' + 'I' + (posY + 1));		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'F' + (posY + 1) + '-' + 'J' + (posY + 1));    posY++;  }};var insertFuturesLargeStayAllLogs = function(sheet, productCode, beginDate, endDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.FuturesLargeStayAllLogs"] + '.js');		var dao = new tw.ace33022.dao.db.vo.FuturesLargeStayAllLogs(Configurations.Database.getConnection());		var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(productCode, beginDate, endDate);	  var index;  var vo;  var posX = new Number(0);  var posY = new Number(1);	for (index = 0; index < arrVO.length; index++) {					vo = arrVO[index];    posX = 0;				    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());    // sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getProductCode());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayQty());						// 計算差異量		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'B' + (posY + 1) + '-' + 'F' + (posY + 1));		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'C' + (posY + 1) + '-' + 'G' + (posY + 1));		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'D' + (posY + 1) + '-' + 'H' + (posY + 1));		sheet.getObject().getCellByPosition(posX++, posY).setFormula('=' + 'E' + (posY + 1) + '-' + 'I' + (posY + 1));    posY++;  }		return this;};var insertFoundationFuturesDayTrnLogsToSheet = function(arrVO, sheet) {  var index;  var vo;	  var posX = new Number(0);  var posY = new Number(1);  for (index = 0; index < arrVO.length; index++) {    vo = arrVO[index];    posX = 0;    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());    // sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getProductCode());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getBuyQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getBuyTotal());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getSellQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getSellTotal());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayBuyQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayBuyTotal());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStaySellQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStaySellTotal());    posY++;  }		return this;};var insertForeignFuturesDayTrnLogs = function(sheet, productCode, beginDate, endDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.ForeignFuturesDayTrnLogs"] + '.js');	var dao = new tw.ace33022.dao.db.vo.ForeignFuturesDayTrnLogs(Configurations.Database.getConnection());		var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(productCode, beginDate, endDate);		insertFoundationFuturesDayTrnLogsToSheet(arrVO, sheet);};var insertDealerFuturesDayTrnLogs = function(sheet, productCode, beginDate, endDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.DealerFuturesDayTrnLogs"] + '.js');	var dao = new tw.ace33022.dao.db.vo.DealerFuturesDayTrnLogs(Configurations.Database.getConnection());		var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(productCode, beginDate, endDate);		insertFoundationFuturesDayTrnLogsToSheet(arrVO, sheet);};var insertInvestFuturesDayTrnLogs = function(sheet, productCode, beginDate, endDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.InvestFuturesDayTrnLogs"] + '.js');	  var dao = new tw.ace33022.dao.db.vo.InvestFuturesDayTrnLogs(Configurations.Database.getConnection());	var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(productCode, beginDate, endDate);		insertFoundationFuturesDayTrnLogsToSheet(arrVO, sheet);};