/** * * @description OptionUtil * * @version 2015/11/24 ace 初始版本。 * @version 2021/02/03 ace 新增insertOptionTrnLog()函數。 * @version 2021/02/03 ace 新增insertOptionTrnLogToSheet()函數。 * * @author ace * * @see <a href="https://developer.mozilla.org/zh-TW/docs/JavaScript">JavaScript</a> * */function insertMonthOption(spread, productCode, year, month) {	function getBeginTrnDate() {			var sheet = spread.getSheets().getByName('option_call_day_trn_log');				return sheet.getObject().getCellByPosition(0, 1).getFormula();	}		function getEndTrnDate() {			var sheet = spread.getSheets().getByName('option_call_day_trn_log');			var cellRange = Packages.com.sun.star.uno.UnoRuntime.queryInterface(Packages.com.sun.star.sheet.XSheetCellRange, sheet.getObject().getCellRangeByName('A1'));		var cursor = sheet.getObject().createCursorByRange(cellRange);		var usedCursor = Packages.com.sun.star.uno.UnoRuntime.queryInterface(Packages.com.sun.star.sheet.XUsedAreaCursor, cursor);				var addr;			usedCursor.gotoStartOfUsedArea(false);		usedCursor.gotoEndOfUsedArea(true);			addr = Packages.com.sun.star.uno.UnoRuntime.queryInterface(Packages.com.sun.star.sheet.XCellRangeAddressable, usedCursor);			// Packages.javax.swing.JOptionPane.showMessageDialog(null, addr.getRangeAddress().EndRow);				return sheet.getObject().getCellByPosition(0, addr.getRangeAddress().EndRow).getFormula();	}	  // var sheet;	  // sheet = spread.getSheets().getByName('option_call_day_trn_log');	// 若找不到對應的sheet會出現例外的錯誤！  insertOptionCallDayTrnLog(spread.getSheets().getByName('option_call_day_trn_log'), productCode, year, month);	  // sheet = spread.getSheets().getByName('option_put_day_trn_log');	// 若找不到對應的sheet會出現例外的錯誤！  insertOptionPutDayTrnLog(spread.getSheets().getByName('option_put_day_trn_log'), productCode, year, month);	  insertOptionCallLargeStayLog(spread.getSheets().getByName('option_call_large_stay_log'), productCode, year, month);  insertOptionPutLargeStayLog(spread.getSheets().getByName('option_put_large_stay_log'), productCode, year, month);  insertOptionCallLargeStayAllLog(spread.getSheets().getByName('option_call_large_stay_all_log'), productCode, getBeginTrnDate(), getEndTrnDate());  insertOptionPutLargeStayAllLog(spread.getSheets().getByName('option_put_large_stay_all_log'), productCode, getBeginTrnDate(), getEndTrnDate());	  insertForeignOptionDayTrnLog(spread.getSheets().getByName('foreign_option_day_trn_log'), productCode, getBeginTrnDate(), getEndTrnDate());  insertDealerOptionDayTrnLog(spread.getSheets().getByName('dealer_option_day_trn_log'), productCode, getBeginTrnDate(), getEndTrnDate());  insertInvestOptionDayTrnLog(spread.getSheets().getByName('invest_option_day_trn_log'), productCode, getBeginTrnDate(), getEndTrnDate());}function insertOptionDayTrnLogToSheet(arrVO, sheet) {  var vo;	  var index;  var posX = new Number(0);  var posY = new Number(1);	  for (index = 0; index < arrVO.length; index++) {		vo = arrVO[index];				    posX = 0;		    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());    sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getConMonth());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStrikePrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getOpenPrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getHighPrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getLowPrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getClosePrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getLastCalPrice());										// 結算價    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnQty());													// 交易量    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayQty());												// 未平倉量		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getLastCalPrice() * vo.getStayQty());	// 未平倉金額		    posY++;  }};function insertOptionCallDayTrnLog(sheet, productCode, year, month) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.OptionCallDayTrnLog"] + '.js');	  var dao = new tw.ace33022.dao.db.vo.OptionCallDayTrnLog(Configuration.Database.getConnection());	var arrVO = dao.doSelectByConMonthOrderByTrnDateAndStrikePrice(productCode, new String(year + month));		insertOptionDayTrnLogToSheet(arrVO, sheet);}function insertOptionPutDayTrnLog(sheet, productCode, year, month) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.OptionPutDayTrnLog'] + '.js');  var dao = new tw.ace33022.dao.db.vo.OptionPutDayTrnLog(Configuration.Database.getConnection());  var arrVO = dao.doSelectByConMonthOrderByTrnDateAndStrikePrice(productCode, new String(year + month));		insertOptionDayTrnLogToSheet(arrVO, sheet);}function insertOptionLargeStayLogToSheet(arrVO, sheet) {  var vo;	  var index;  var posX = new Number(0);  var posY = new Number(1);	  for (index = 0; index < arrVO.length; index++) {		vo = arrVO[index];				    posX = 0;		    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());		sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getConMonth());    // sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getProductCode());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurBuy());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurBuy());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurSell());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurSell());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayQty());		    posY++;  }}function insertOptionCallLargeStayLog(sheet, productCode, year, month) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.OptionCallLargeStayLog'] + '.js');		var conMonth = new String(year + month);  var dao = new tw.ace33022.dao.db.vo.OptionCallLargeStayLog(Configuration.Database.getConnection());  var arrVO = dao.doSelectByConMonthOrderByTrnDate(productCode, conMonth);		insertOptionLargeStayLogToSheet(arrVO, sheet);}function insertOptionPutLargeStayLog(sheet, productCode, year, month) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.OptionPutLargeStayLog'] + '.js');	  var dao = new tw.ace33022.dao.db.vo.OptionPutLargeStayLog(Configuration.Database.getConnection());	var arrVO = dao.doSelectByConMonthOrderByTrnDate(productCode, new String(year + month));		insertOptionLargeStayLogToSheet(arrVO, sheet);}function insertOptionLargeStayAllLogToSheet(arrVO, sheet) {  var vo;	  var index;  var posX = new Number(0);  var posY = new Number(1);	  for (index = 0; index < arrVO.length; index++) {		vo = arrVO[index];				    posX = 0;		    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());    // sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getProductCode());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurBuy());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenBuy());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurBuy());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreFiveJurSell());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenSell());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPreTenJurSell());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayQty());		    posY++;  }}function insertOptionCallLargeStayAllLog(sheet, productCode, beginTrnDate, endTrnDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.OptionCallLargeStayAllLog'] + '.js');  var dao = new tw.ace33022.dao.db.vo.OptionCallLargeStayAllLog(Configuration.Database.getConnection());  var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode);		insertOptionLargeStayAllLogToSheet(arrVO, sheet);}function insertOptionPutLargeStayAllLog(sheet, productCode, beginTrnDate, endTrnDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.OptionPutLargeStayAllLog'] + '.js');  var dao = new tw.ace33022.dao.db.vo.OptionPutLargeStayAllLog(Configuration.Database.getConnection());	var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode);		insertOptionLargeStayAllLogToSheet(arrVO, sheet);}function insertFoundationOptionDayTrnLogToSheet(arrVO, sheet) {  var vo;	  var index;  var posX = new Number(0);  var posY = new Number(1);	  for (index = 0; index < arrVO.length; index++) {		vo = arrVO[index];				    posX = 0;		    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getCallBuyQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getCallBuyTotal());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getCallSellQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getCallSellTotal());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPutBuyQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPutBuyTotal());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPutSellQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getPutSellTotal());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayCallBuyQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayCallBuyTotal());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayCallSellQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayCallSellTotal());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayPutBuyQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayPutBuyTotal());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayPutSellQty());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayPutSellTotal());		    posY++;  }};function insertForeignOptionDayTrnLog(sheet, productCode, beginTrnDate, endTrnDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.ForeignOptionDayTrnLog'] + '.js');  var dao = new tw.ace33022.dao.db.vo.ForeignOptionDayTrnLog(Configuration.Database.getConnection());  var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode);		insertFoundationOptionDayTrnLogToSheet(arrVO, sheet);}function insertDealerOptionDayTrnLog(sheet, productCode, beginTrnDate, endTrnDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.DealerOptionDayTrnLog'] + '.js');  var dao = new tw.ace33022.dao.db.vo.DealerOptionDayTrnLog(Configuration.Database.getConnection());  var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode);		insertFoundationOptionDayTrnLogToSheet(arrVO, sheet);}function insertInvestOptionDayTrnLog(sheet, productCode, beginTrnDate, endTrnDate) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths['tw.ace33022.dao.db.vo.InvestOptionDayTrnLog'] + '.js');  var dao = new tw.ace33022.dao.db.vo.InvestOptionDayTrnLog(Configuration.Database.getConnection());  var arrVO = dao.doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode);		insertFoundationOptionDayTrnLogToSheet(arrVO, sheet);}function insertOptionTrnLog(spread, productCode) {	load(Configuration["JSLibDir"] + '/tw/ace33022/util/Rhino/StockUtil.js');		load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.vo.OptionCallTrnLog"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.vo.OptionPutTrnLog"] + '.js');		var result = JSON.parse(tw.ace33022.util.StockUtil.getAllOptionRealTimeTrnLog(productCode));		var arrVO;	var index;	var vo;		arrVO = new Array();	for (index = 0; index < result["call"].length; index++) {			vo = new tw.ace33022.vo.OptionCallTrnLog();			vo.setValueFromJSONObject(result["call"][index]);		arrVO.push(vo);	}		insertOptionTrnLogToSheet(arrVO, spread.getSheets().getByName('option_call_trn_log'));		arrVO = new Array();	for (index = 0; index < result["put"].length; index++) {			vo = new tw.ace33022.vo.OptionPutTrnLog();			vo.setValueFromJSONObject(result["put"][index]);		arrVO.push(vo);	}		insertOptionTrnLogToSheet(arrVO, spread.getSheets().getByName('option_put_trn_log'));}function insertOptionTrnLogToSheet(arrVO, sheet) {  var vo;	  var index;  var posX = new Number(0);  var posY = new Number(1);	  for (index = 0; index < arrVO.length; index++) {		vo = arrVO[index];				    posX = 0;		    // sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnDate());    sheet.getObject().getCellByPosition(posX++, posY).setFormula(vo.getConMonth());		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStrikePrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getOpenPrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getHighPrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getLowPrice());    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getClosePrice());		// 成交價。    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getTrnQty());				// 交易量。    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getStayQty());			// 未平倉量。    sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getBestAskPrice());	// 委賣價。		sheet.getObject().getCellByPosition(posX++, posY).setValue(vo.getBestBidPrice());	// 委買價。		    posY++;  }};